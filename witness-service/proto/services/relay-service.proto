syntax = "proto3";

package services;

import "google/api/annotations.proto";
import "types/witness.proto";
import "types/witnesseslist.proto";

option go_package = "github.com/iotexproject/ioTube/witness-service/grpc/services";

service RelayService {
    rpc Submit(types.Witness) returns (WitnessSubmissionResponse) {
        option (google.api.http) = {
            post: "/submit"
            body: "*"
        };
    };
    rpc Reset(ResetTransferRequest) returns (ResetTransferResponse) {
        option (google.api.http) = {
            post: "/reset"
            body: "*"
        };
    };
    rpc Check(CheckRequest) returns (CheckResponse) {
        option (google.api.http) = {
            post: "/check"
            body: "*"
        };
    };
    rpc Retry(RetryRequest) returns (RetryResponse) {
        option (google.api.http) = {
            post: "/retry"
            body: "*"
        };
    };
    rpc Lookup(LookupRequest) returns (LookupResponse) {
        option (google.api.http) = {
            post: "/lookup"
            body: "*"
        };
    };
    rpc StaleHeights(StaleHeightsRequest) returns (StaleHeightsResponse) {
        option (google.api.http) = {
            post: "/stale_heights"
            body: "*"
        };
    };
    rpc List(ListRequest) returns (ListResponse) {
        option (google.api.http) = {
            post: "/list"
            body: "*"
        };
    };
    rpc SubmitNewTX(SubmitNewTXRequest) returns (SubmitNewTXResponse) {
        option (google.api.http) = {
            post: "/submitnewtx"
            body: "*"
        };
    };
    rpc ListNewTX(ListNewTXRequest) returns (ListNewTXResponse) {
        option (google.api.http) = {
            post: "/listnewtx"
            body: "*"
        };
    };
    rpc SubmitWitnessesList(types.WitnessesList) returns (WitnessListSubmissionResponse) {
        option (google.api.http) = {
            post: "/submit_witnesses"
            body: "*"
        };
    }; 
    rpc CheckWitnessesList(CheckRequest) returns (CheckWitnessesListResponse) {
        option (google.api.http) = {
            post: "/check_witnesses"
            body: "*"
        };
    }; 
}

message CheckRequest {
    bytes id = 1;
}

enum Status {
    UNKNOWN = 0;
    CREATED = 1;
    SUBMITTED = 2;
    SETTLED = 3;
    FAILED = 4;
    CONFIRMING = 5;
}

message LookupRequest {
    bytes sourceTxHash = 1;
}

message LookupResponse {
	repeated CheckResponse statuses = 1;
}

message CheckResponse {
    bytes key = 1;
    repeated bytes witnesses = 2;
    bytes txHash = 3;
    Status status = 4;
}

message CheckWitnessesListResponse {
    bytes key = 1;
    repeated bytes witnesses = 2;
    Status status = 3;
}

message StaleHeightsRequest {
    bytes cashier = 1;
}

message StaleHeightsResponse {
    repeated uint64 heights = 1;
}

message ListRequest {
	int32 first = 1;
	int32 skip = 2;
	bytes token = 3;
	bytes sender = 4;
	bytes recipient = 5;
	Status status = 6;
}

message ListResponse {
	repeated types.Transfer transfers = 1;
	repeated CheckResponse statuses = 2;
	uint32 count = 3;
}

message ResetTransferRequest {
    bytes id = 1;
}

message ResetTransferResponse {
    bool success = 1;
}

message WitnessSubmissionResponse {
    bytes id = 1;
    bool success = 2;
}

message WitnessListSubmissionResponse {
    bytes id = 1;
    bool success = 2;
}

message RetryRequest {
    bytes cashier = 1;
    uint64 height = 2;
}

message RetryResponse {
    bool success = 1;
}

message SubmitNewTXRequest {
	uint64 height = 1;
	bytes txHash = 2;
}

message SubmitNewTXResponse {
    bool success = 1;
}

message ListNewTXRequest {
    uint32 count = 1;
}

message ListNewTXResponse {
    repeated SubmitNewTXRequest txs = 1;
}
